{"ast":null,"code":"var _jsxFileName = \"/home/ubuntu/\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B/Daniil/FicusTest/my-app/src/components/CreateEdit-post/createEdit-post.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useRef, useState } from 'react';\nimport WithServer from '../hoc';\nimport { useHistory, useParams } from 'react-router';\nimport { useDispatch, useSelector } from 'react-redux';\nimport ModalConfirm from '../modalConfirm';\nimport Spinner from '../spinner';\nimport Error from '../error';\nimport defaultImage from '../../image/default-image.jpg';\nimport defimg from '../../image/defimg.jpg';\nimport './createEdit-post.sass';\nimport { loaded, deletePost } from '../../redux/posts/actions';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst CreateEditPost = ({\n  Server\n}) => {\n  _s();\n\n  //useSelector\n  const error = useSelector(state => state.postState.error);\n  const loading = useSelector(state => state.postState.loading); //refs\n\n  const refImagePost = useRef();\n  const refMessage = useRef(); // Modal \n\n  const [show, setShow] = useState(false);\n\n  const closeDeleteModal = () => setShow(false);\n\n  const openDeleteModal = () => setShow(true); //useState\n\n\n  const [post, setPost] = useState(null); //inp\n\n  const [title, setTitle] = useState('');\n  const [description, setDescription] = useState('');\n  const [fullText, setFullText] = useState('');\n  const [message, setMessage] = useState('');\n  const [image, setImage] = useState(null);\n  const [errorForm, setError] = useState({\n    error: false,\n    message: '',\n    success: false\n  });\n\n  const formError = (err, text, scs) => {\n    setError({\n      error: err,\n      message: text,\n      scs: scs\n    });\n    setTimeout(() => setError({\n      error: false,\n      message: '',\n      success: false\n    }), 1600);\n  }; //useDispatch\n\n\n  const dispatch = useDispatch(); //History\n\n  const history = useHistory(); //useParams\n\n  const {\n    id\n  } = useParams(); // token \n\n  const token = localStorage.getItem('token');\n  const user = JSON.parse(localStorage.getItem('user')); //Effect and func\n  //?Edit...................................................................................................................\n\n  const messageResponse = (ref, message, color) => {\n    ref.current.classList.add(color);\n    setMessage(message);\n    setTimeout(() => setMessage(''), 1500);\n  };\n\n  const changePost = (id, token, title, description, fullText) => {\n    Server.updatePost(id, token, title, description, fullText, history, user).then(res => messageResponse(refMessage, 'Sucсess', 'green')).catch(e => messageResponse(refMessage, 'Something went wrong', 'red'));\n  };\n\n  const changePostImage = (img, id, token) => {\n    let formData = new FormData();\n    formData.append('image', img);\n    Server.updatePostImage(id, token, formData, refImagePost).then(res => messageResponse(refMessage, 'Sucсess', 'green')).catch(e => messageResponse(refMessage, 'Something went wrong', 'red'));\n  };\n\n  const delPost = () => {\n    dispatch(deletePost(id, token, history));\n    closeDeleteModal();\n  }; //?Create...................................................................................................................\n\n\n  const createPost = () => {\n    Server.createNewPost(title, fullText, description, token, formError, history, user._id).then(res => {\n      if (image) {\n        changePostImage(image, res.data._id, token);\n      }\n    });\n  };\n\n  useEffect(() => {\n    if (id) {\n      Server.getPost(id).then(res => {\n        dispatch(loaded());\n        setPost(res.data);\n        Server.getImage(refImagePost, res.data.image, defaultImage, '');\n      }).catch(res => setPost(null));\n    } else {\n      setPost(null);\n    }\n  }, [Server, dispatch, id]);\n\n  if (loading && post) {\n    return /*#__PURE__*/_jsxDEV(Spinner, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 16\n    }, this);\n  }\n\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(Error, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 16\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"editor\",\n      onClick: () => console.log(errorForm),\n      children: [/*#__PURE__*/_jsxDEV(ModalConfirm, {\n        show: show,\n        handleClose: closeDeleteModal,\n        remove: delPost,\n        label: 'Are you sure you want to delete this post?'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 125,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"editor-body\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"item\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"item-post\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"post-item-list\",\n              children: [post && id && /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"menu-post delete\",\n                onClick: () => openDeleteModal(),\n                children: /*#__PURE__*/_jsxDEV(\"i\", {\n                  className: \"fa fa-trash-o\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 139,\n                  columnNumber: 34\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 136,\n                columnNumber: 48\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"info-post\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"editor-header-post\",\n                  children: /*#__PURE__*/_jsxDEV(\"input\", {\n                    type: \"text\",\n                    title: \"Title your post\",\n                    className: `title editor-title ${errorForm.error && !title && 'border-error'}`,\n                    placeholder: post && id ? post.title : 'Title your post',\n                    value: title,\n                    onChange: e => setTitle(e.target.value)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 142,\n                    columnNumber: 41\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 141,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"editor-description\",\n                  children: /*#__PURE__*/_jsxDEV(\"input\", {\n                    title: \"Description your post\",\n                    type: \"text\",\n                    className: `editor-description ${errorForm.error && !description && 'border-error'}`,\n                    placeholder: post && id ? post.description : 'Description your post',\n                    value: description,\n                    onChange: e => setDescription(e.target.value)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 151,\n                    columnNumber: 41\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 150,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"editor-image\",\n                  children: [post && id ? /*#__PURE__*/_jsxDEV(\"img\", {\n                    src: defaultImage,\n                    alt: \"post_image\",\n                    className: \"post-image\",\n                    ref: refImagePost\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 162,\n                    columnNumber: 47\n                  }, this) : /*#__PURE__*/_jsxDEV(\"img\", {\n                    src: defimg,\n                    alt: \"post_img\",\n                    className: \"post-image\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 163,\n                    columnNumber: 47\n                  }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n                    htmlFor: \"file-upload\",\n                    className: \"inp-upload\",\n                    children: [/*#__PURE__*/_jsxDEV(\"i\", {\n                      className: \"fa fa-camera\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 166,\n                      columnNumber: 45\n                    }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                      type: \"file\",\n                      accept: \"image/*\",\n                      id: \"file-upload\",\n                      onChange: e => post && id ? changePostImage(e.target.files[0], id, token) : setImage(e.target.files[0])\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 167,\n                      columnNumber: 45\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 165,\n                    columnNumber: 41\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 160,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"editor-full-text\",\n                  children: /*#__PURE__*/_jsxDEV(\"textarea\", {\n                    title: \"Full text your post\",\n                    className: `form-control editor-full-text ${errorForm.error && !fullText && 'border-error'}`,\n                    rows: \"2\",\n                    placeholder: post && id ? post.fullText : 'Full text your post',\n                    value: fullText,\n                    onChange: e => setFullText(e.target.value)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 176,\n                    columnNumber: 41\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 175,\n                  columnNumber: 37\n                }, this), id ? /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"save save-edit\",\n                  onClick: () => changePost(id, token, title, description, fullText),\n                  children: \"Edit\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 188,\n                  columnNumber: 43\n                }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"btn-create\",\n                  onClick: createPost,\n                  children: \"Create post\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 189,\n                  columnNumber: 43\n                }, this), !errorForm.error && /*#__PURE__*/_jsxDEV(\"p\", {\n                  className: `form-error green ${errorForm.success && 'green'}`,\n                  children: [errorForm.message, \"1\"]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 191,\n                  columnNumber: 58\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 140,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 135,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 134,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 133,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 131,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 13\n    }, this)\n  }, void 0, false);\n};\n\n_s(CreateEditPost, \"citAgEt3urc1F6Ma7yeEeu+GqYg=\", false, function () {\n  return [useSelector, useSelector, useDispatch, useHistory, useParams];\n});\n\n_c = CreateEditPost;\nexport default WithServer()(CreateEditPost);\n\nvar _c;\n\n$RefreshReg$(_c, \"CreateEditPost\");","map":{"version":3,"sources":["/home/ubuntu/Рабочий стол/Daniil/FicusTest/my-app/src/components/CreateEdit-post/createEdit-post.js"],"names":["React","useEffect","useRef","useState","WithServer","useHistory","useParams","useDispatch","useSelector","ModalConfirm","Spinner","Error","defaultImage","defimg","loaded","deletePost","CreateEditPost","Server","error","state","postState","loading","refImagePost","refMessage","show","setShow","closeDeleteModal","openDeleteModal","post","setPost","title","setTitle","description","setDescription","fullText","setFullText","message","setMessage","image","setImage","errorForm","setError","success","formError","err","text","scs","setTimeout","dispatch","history","id","token","localStorage","getItem","user","JSON","parse","messageResponse","ref","color","current","classList","add","changePost","updatePost","then","res","catch","e","changePostImage","img","formData","FormData","append","updatePostImage","delPost","createPost","createNewPost","_id","data","getPost","getImage","console","log","target","value","files"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport WithServer from '../hoc';\nimport { useHistory, useParams } from 'react-router';\nimport { useDispatch, useSelector } from 'react-redux';\nimport ModalConfirm from '../modalConfirm';\nimport Spinner from '../spinner'\nimport Error from '../error';\n\nimport defaultImage from '../../image/default-image.jpg'\nimport defimg from '../../image/defimg.jpg'\nimport './createEdit-post.sass'\n\nimport { loaded, deletePost } from '../../redux/posts/actions'\n\n\nconst CreateEditPost = ({ Server }) => {\n    //useSelector\n    const error = useSelector(state => state.postState.error)\n    const loading = useSelector(state => state.postState.loading)\n\n    //refs\n    const refImagePost = useRef()\n    const refMessage = useRef()\n\n    // Modal \n    const [show, setShow] = useState(false)\n    const closeDeleteModal = () => setShow(false)\n    const openDeleteModal = () => setShow(true)\n\n\n    //useState\n    const [post, setPost] = useState(null)\n    //inp\n    const [title, setTitle] = useState('')\n    const [description, setDescription] = useState('')\n    const [fullText, setFullText] = useState('')\n    const [message, setMessage] = useState('')\n    const [image, setImage] = useState(null)\n\n    const [errorForm, setError] = useState({ error: false, message: '', success: false })\n    const formError = (err, text, scs) => {\n        setError({ error: err, message: text, scs: scs })\n        setTimeout(() => setError({ error: false, message: '', success: false }), 1600)\n    }\n\n    //useDispatch\n    const dispatch = useDispatch()\n\n    //History\n    const history = useHistory()\n\n    //useParams\n    const { id } = useParams()\n\n    // token \n    const token = localStorage.getItem('token')\n    const user = JSON.parse(localStorage.getItem('user'));\n\n    //Effect and func\n\n    //?Edit...................................................................................................................\n\n    const messageResponse = (ref, message, color) => {\n        ref.current.classList.add(color)\n        setMessage(message)\n        setTimeout(() => setMessage(''), 1500)\n    }\n\n    const changePost = (id, token, title, description, fullText) => {\n        Server.updatePost(id, token, title, description, fullText, history, user)\n            .then(res => messageResponse(refMessage, 'Sucсess', 'green'))\n            .catch(e => messageResponse(refMessage, 'Something went wrong', 'red'))\n    }\n\n    const changePostImage = (img, id, token) => {\n        let formData = new FormData()\n        formData.append('image', img)\n        Server.updatePostImage(id, token, formData, refImagePost)\n            .then(res => messageResponse(refMessage, 'Sucсess', 'green'))\n            .catch(e => messageResponse(refMessage, 'Something went wrong', 'red'))\n    }\n\n    const delPost = () => {\n        dispatch(deletePost(id, token, history))\n        closeDeleteModal()\n    }\n\n    //?Create...................................................................................................................\n\n    const createPost = () => {\n        Server.createNewPost(title, fullText, description, token, formError, history, user._id)\n            .then(res => {\n                if (image) {\n                    changePostImage(image, res.data._id, token)\n                }\n            })\n    }\n\n\n    useEffect(() => {\n        if (id) {\n            Server.getPost(id)\n                .then(res => {\n                    dispatch(loaded())\n                    setPost(res.data)\n                    Server.getImage(refImagePost, res.data.image, defaultImage, '')\n                })\n                .catch(res => setPost(null))\n        } else {\n            setPost(null)\n        }\n    }, [Server, dispatch, id])\n\n    if (loading && post) {\n        return <Spinner />\n    }\n\n    if (error) {\n        return <Error />\n    }\n\n    return (\n        <>\n            <div className='editor' onClick={() => console.log(errorForm)}>\n                <ModalConfirm\n                    show={show}\n                    handleClose={closeDeleteModal}\n                    remove={delPost}\n                    label={'Are you sure you want to delete this post?'}\n                />\n                <div className='editor-body'>\n\n                    <div className=\"item\">\n                        <div className=\"item-post\">\n                            <div className=\"post-item-list\">\n                                {post && id && <button\n                                    className='menu-post delete'\n                                    onClick={() => openDeleteModal()}\n                                ><i className=\"fa fa-trash-o\"></i></button>}\n                                <div className=\"info-post\">\n                                    <div className='editor-header-post'>\n                                        <input type=\"text\"\n                                            title='Title your post'\n                                            className={`title editor-title ${errorForm.error && !title && 'border-error'}`}\n                                            placeholder={post && id ? post.title : 'Title your post'}\n                                            value={title}\n                                            onChange={(e) => setTitle(e.target.value)}\n                                        />\n                                    </div>\n                                    <div className='editor-description'>\n                                        <input\n                                            title='Description your post'\n                                            type=\"text\"\n                                            className={`editor-description ${errorForm.error && !description && 'border-error'}`}\n                                            placeholder={post && id ? post.description : 'Description your post'}\n                                            value={description}\n                                            onChange={(e) => setDescription(e.target.value)}\n                                        />\n                                    </div>\n                                    <div className='editor-image'>\n                                        {post && id\n                                            ? <img src={defaultImage} alt='post_image' className=\"post-image\" ref={refImagePost} />\n                                            : <img src={defimg} alt='post_img' className=\"post-image\" />\n                                        }\n                                        <label htmlFor='file-upload' className='inp-upload' >\n                                            <i className=\"fa fa-camera\"></i>\n                                            <input\n                                                type='file'\n                                                accept=\"image/*\"\n                                                id=\"file-upload\"\n                                                onChange={(e) => post && id ? changePostImage(e.target.files[0], id, token) : setImage(e.target.files[0])}\n                                            />\n                                        </label>\n                                    </div>\n                                    <div className='editor-full-text'>\n                                        <textarea\n                                            title='Full text your post'\n                                            className={`form-control editor-full-text ${errorForm.error && !fullText && 'border-error'}`}\n                                            rows=\"2\"\n                                            placeholder={post && id ? post.fullText : 'Full text your post'}\n                                            value={fullText}\n                                            onChange={(e) => setFullText(e.target.value)}\n                                        >\n                                        </textarea>\n\n                                    </div>\n                                    {id\n                                        ? <button className='save save-edit' onClick={() => changePost(id, token, title, description, fullText)}>Edit</button>\n                                        : <button className='btn-create' onClick={createPost}>Create post</button>\n                                    }\n                                    {!errorForm.error && <p className={`form-error green ${errorForm.success && 'green'}`}>{errorForm.message}1</p>}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                </div>\n            </div>\n        </>\n    )\n}\n\nexport default WithServer()(CreateEditPost);"]},"metadata":{},"sourceType":"module"}