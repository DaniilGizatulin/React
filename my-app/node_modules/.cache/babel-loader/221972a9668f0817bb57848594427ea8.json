{"ast":null,"code":"var _jsxFileName = \"/home/ubuntu/\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B/Daniil/FicusTest/my-app/src/components/CreateEdit-post/createEdit-post.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useRef, useState } from 'react';\nimport WithServer from '../hoc';\nimport { useHistory, useParams } from 'react-router';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { loaded, remove, fault } from '../../actions';\nimport ModalConfirm from '../modalConfirm';\nimport Spinner from '../spinner';\nimport Error from '../error';\nimport defaultImage from './default-image.jpg';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst CreateEditPost = ({\n  Server\n}) => {\n  _s();\n\n  //useSelector\n  const error = useSelector(state => state.error);\n  const loading = useSelector(state => state.loading); //refs\n\n  const refImagePost = useRef();\n  const refMessage = useRef(); // Modal \n\n  const [show, setShow] = useState(false);\n\n  const closeDeleteModal = () => setShow(false);\n\n  const openDeleteModal = () => setShow(true); //useState\n\n\n  const [post, setPost] = useState(null); //inp\n\n  const [title, setTitle] = useState('');\n  const [description, setDescription] = useState('');\n  const [fullText, setFullText] = useState('');\n  const [message, setMessage] = useState(''); //useDispatch\n\n  const dispatch = useDispatch(); //History\n\n  const history = useHistory(); //useParams\n\n  const {\n    id\n  } = useParams(); // token \n\n  const token = localStorage.getItem('token');\n  const user = JSON.parse(localStorage.getItem('user')); //Effect and func\n  //edit\n\n  const messageResponse = (ref, message, color) => {\n    ref.current.classList.add(color);\n    setMessage(message);\n    setTimeout(() => setMessage(''), 1500);\n  };\n\n  const changePost = (id, token, title, description, fullText) => {\n    Server.updatePost(id, token, title, description, fullText).then(res => {\n      console.log(res);\n      messageResponse(refMessage, 'Sucсess', 'green');\n      setTimeout(() => history.push(`/user-posts/${user._id}`), 1500);\n    }).catch(e => messageResponse(refMessage, 'Something went wrong', 'red'));\n  };\n\n  const changePostImage = e => {\n    let formData = new FormData();\n    formData.append('image', e.target.files[0]);\n    Server.updatePostImage(id, token, formData).then(res => {\n      messageResponse(refMessage, 'Sucсess', 'green');\n      Server.getPost(id).then(res => Server.getImage(refImagePost, res.data.image));\n    }).catch(e => messageResponse(refMessage, 'Something went wrong', 'red'));\n  };\n\n  const delPost = () => {\n    Server.deletePost(id, token).then(res => {\n      closeDeleteModal();\n      dispatch(remove(true));\n      setTimeout(() => {\n        history.push(`/list/${0}`);\n        dispatch(remove(false));\n      }, 500);\n    });\n  }; //create \n\n\n  const createPost = () => {\n    Server.createNewPost(title, fullText, description, token).then(res => {\n      if (res.status >= 400) {\n        setMessage(res.data.error[0].message);\n      }\n\n      if (res.status === 200) {\n        setTimeout(() => history.push(`/user-posts/${user._id}`), 1500);\n      }\n    }).catch(e => dispatch(fault()));\n  };\n\n  useEffect(() => {\n    if (id) {\n      Server.getPost(id).then(res => {\n        dispatch(loaded());\n        setPost(res.data);\n        Server.getImage(refImagePost, res.data.image, defaultImage, '');\n      }).catch(res => setPost(null));\n    }\n  }, [Server, dispatch, id]);\n\n  const form = /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"editor\",\n    children: [/*#__PURE__*/_jsxDEV(ModalConfirm, {\n      show: show,\n      handleClose: closeDeleteModal,\n      remove: delPost,\n      label: 'Are you sure you want to delete this post?'\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 118,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"editor-body\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"item\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"item-post\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"post-item-list\",\n            children: [id && /*#__PURE__*/_jsxDEV(\"button\", {\n              className: \"menu-post delete\",\n              onClick: () => openDeleteModal(),\n              children: /*#__PURE__*/_jsxDEV(\"i\", {\n                className: \"fa fa-trash-o\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 132,\n                columnNumber: 30\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 129,\n              columnNumber: 36\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"info-post\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"editor-header-post\",\n                children: /*#__PURE__*/_jsxDEV(\"input\", {\n                  type: \"text\",\n                  title: \"Title your post\",\n                  className: \"title editor-title\",\n                  placeholder: id ? post.title : 'Title your post',\n                  value: title,\n                  onChange: e => setTitle(e.target.value)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 135,\n                  columnNumber: 37\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 134,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"editor-description\",\n                children: /*#__PURE__*/_jsxDEV(\"input\", {\n                  title: \"Description your post\",\n                  type: \"text\",\n                  className: \" editor-description\",\n                  placeholder: id ? post.description : 'Description your post',\n                  value: description,\n                  onChange: e => setDescription(e.target.value)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 144,\n                  columnNumber: 37\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 143,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"editor-image\",\n                children: [/*#__PURE__*/_jsxDEV(\"img\", {\n                  src: defaultImage,\n                  alt: \"post_image\",\n                  className: \"post-image\",\n                  ref: refImagePost\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 154,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n                  htmlFor: \"file-upload\",\n                  className: \"inp-upload\",\n                  children: [/*#__PURE__*/_jsxDEV(\"i\", {\n                    className: \"fa fa-camera\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 156,\n                    columnNumber: 41\n                  }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                    type: \"file\",\n                    accept: \"image/*\",\n                    id: \"file-upload\",\n                    onChange: e => changePostImage(e)\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 157,\n                    columnNumber: 41\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 155,\n                  columnNumber: 37\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 153,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"editor-full-text\",\n                children: /*#__PURE__*/_jsxDEV(\"textarea\", {\n                  title: \"Full text your post\",\n                  className: \"form-control editor-full-text\",\n                  rows: \"2\",\n                  placeholder: id ? post.fullText : 'Full text your post',\n                  value: fullText,\n                  onChange: e => setFullText(e.target.value)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 166,\n                  columnNumber: 37\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 165,\n                columnNumber: 33\n              }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n                className: \"message\",\n                ref: refMessage,\n                children: message\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 177,\n                columnNumber: 33\n              }, this), id ? /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"save\",\n                onClick: () => changePost(id, token, title, description, fullText),\n                children: \"Edit\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 179,\n                columnNumber: 39\n              }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"btn-create\",\n                onClick: createPost,\n                children: \"Create post\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 180,\n                columnNumber: 39\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 133,\n              columnNumber: 29\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 128,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 127,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 126,\n        columnNumber: 17\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 124,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 117,\n    columnNumber: 9\n  }, this);\n\n  if (loading) {\n    return /*#__PURE__*/_jsxDEV(Spinner, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 191,\n      columnNumber: 16\n    }, this);\n  }\n\n  if (error) {\n    return /*#__PURE__*/_jsxDEV(Error, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 195,\n      columnNumber: 16\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: form\n  }, void 0, false);\n};\n\n_s(CreateEditPost, \"TPwTtPwx4uw918NATn5bJP+hvBk=\", false, function () {\n  return [useSelector, useSelector, useDispatch, useHistory, useParams];\n});\n\n_c = CreateEditPost;\nexport default WithServer()(CreateEditPost);\n\nvar _c;\n\n$RefreshReg$(_c, \"CreateEditPost\");","map":{"version":3,"sources":["/home/ubuntu/Рабочий стол/Daniil/FicusTest/my-app/src/components/CreateEdit-post/createEdit-post.js"],"names":["React","useEffect","useRef","useState","WithServer","useHistory","useParams","useDispatch","useSelector","loaded","remove","fault","ModalConfirm","Spinner","Error","defaultImage","CreateEditPost","Server","error","state","loading","refImagePost","refMessage","show","setShow","closeDeleteModal","openDeleteModal","post","setPost","title","setTitle","description","setDescription","fullText","setFullText","message","setMessage","dispatch","history","id","token","localStorage","getItem","user","JSON","parse","messageResponse","ref","color","current","classList","add","setTimeout","changePost","updatePost","then","res","console","log","push","_id","catch","e","changePostImage","formData","FormData","append","target","files","updatePostImage","getPost","getImage","data","image","delPost","deletePost","createPost","createNewPost","status","form","value"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport WithServer from '../hoc';\nimport { useHistory, useParams } from 'react-router';\nimport { useDispatch, useSelector } from 'react-redux';\nimport { loaded, remove, fault } from '../../actions';\nimport ModalConfirm from '../modalConfirm';\nimport Spinner from '../spinner'\nimport Error from '../error';\n\nimport defaultImage from './default-image.jpg'\n\n\nconst CreateEditPost = ({ Server }) => {\n    //useSelector\n    const error = useSelector(state => state.error)\n    const loading = useSelector(state => state.loading)\n\n    //refs\n    const refImagePost = useRef()\n    const refMessage = useRef()\n\n    // Modal \n    const [show, setShow] = useState(false)\n    const closeDeleteModal = () => setShow(false)\n    const openDeleteModal = () => setShow(true)\n\n\n    //useState\n    const [post, setPost] = useState(null)\n    //inp\n    const [title, setTitle] = useState('')\n    const [description, setDescription] = useState('')\n    const [fullText, setFullText] = useState('')\n    const [message, setMessage] = useState('')\n\n    //useDispatch\n    const dispatch = useDispatch()\n\n    //History\n    const history = useHistory()\n\n    //useParams\n    const { id } = useParams()\n\n    // token \n    const token = localStorage.getItem('token')\n    const user = JSON.parse(localStorage.getItem('user'));\n\n    //Effect and func\n    //edit\n    const messageResponse = (ref, message, color) => {\n        ref.current.classList.add(color)\n        setMessage(message)\n        setTimeout(() => setMessage(''), 1500)\n    }\n\n    const changePost = (id, token, title, description, fullText) => {\n        Server.updatePost(id, token, title, description, fullText)\n            .then(res => {\n                console.log(res)\n                messageResponse(refMessage, 'Sucсess', 'green')\n                setTimeout(() => history.push(`/user-posts/${user._id}`), 1500)\n            })\n            .catch(e => messageResponse(refMessage, 'Something went wrong', 'red'))\n    }\n\n    const changePostImage = (e) => {\n        let formData = new FormData()\n        formData.append('image', e.target.files[0])\n        Server.updatePostImage(id, token, formData)\n            .then(res => {\n                messageResponse(refMessage, 'Sucсess', 'green')\n                Server.getPost(id)\n                    .then(res => Server.getImage(refImagePost, res.data.image))\n            })\n            .catch(e => messageResponse(refMessage, 'Something went wrong', 'red'))\n    }\n\n    const delPost = () => {\n        Server.deletePost(id, token)\n            .then(res => {\n                closeDeleteModal()\n                dispatch(remove(true))\n                setTimeout(() => {\n                    history.push(`/list/${0}`)\n                    dispatch(remove(false))\n                }, 500)\n            })\n    }\n    //create \n    const createPost = () => {\n        Server.createNewPost(title, fullText, description, token)\n            .then(res => {\n                if (res.status >= 400) {\n                    setMessage(res.data.error[0].message)\n                } if (res.status === 200) {\n                    setTimeout(() => history.push(`/user-posts/${user._id}`), 1500)\n                }\n            })\n            .catch(e => dispatch(fault()))\n    }\n\n    useEffect(() => {\n        if (id) {\n            Server.getPost(id)\n                .then(res => {\n                    dispatch(loaded())\n                    setPost(res.data)\n                    Server.getImage(refImagePost, res.data.image, defaultImage, '')\n                })\n                .catch(res => setPost(null))\n        }\n    }, [Server, dispatch, id])\n\n\n    const form =\n        <div className='editor' >\n            <ModalConfirm\n                show={show}\n                handleClose={closeDeleteModal}\n                remove={delPost}\n                label={'Are you sure you want to delete this post?'}\n            />\n            <div className='editor-body'>\n\n                <div className=\"item\">\n                    <div className=\"item-post\">\n                        <div className=\"post-item-list\">\n                            {id && <button\n                                className='menu-post delete'\n                                onClick={() => openDeleteModal()}\n                            ><i className=\"fa fa-trash-o\"></i></button>}\n                            <div className=\"info-post\">\n                                <div className='editor-header-post'>\n                                    <input type=\"text\"\n                                        title='Title your post'\n                                        className=\"title editor-title\"\n                                        placeholder={id ? post.title : 'Title your post'}\n                                        value={title}\n                                        onChange={(e) => setTitle(e.target.value)}\n                                    />\n                                </div>\n                                <div className='editor-description'>\n                                    <input\n                                        title='Description your post'\n                                        type=\"text\"\n                                        className=\" editor-description\"\n                                        placeholder={id ? post.description : 'Description your post'}\n                                        value={description}\n                                        onChange={(e) => setDescription(e.target.value)}\n                                    />\n                                </div>\n                                <div className='editor-image'>\n                                    <img src={defaultImage} alt='post_image' className=\"post-image\" ref={refImagePost} />\n                                    <label htmlFor='file-upload' className='inp-upload' >\n                                        <i className=\"fa fa-camera\"></i>\n                                        <input\n                                            type='file'\n                                            accept=\"image/*\"\n                                            id=\"file-upload\"\n                                            onChange={(e) => changePostImage(e)}\n                                        />\n                                    </label>\n                                </div>\n                                <div className='editor-full-text'>\n                                    <textarea\n                                        title='Full text your post'\n                                        className=\"form-control editor-full-text\"\n                                        rows=\"2\"\n                                        placeholder={id ? post.fullText : 'Full text your post'}\n                                        value={fullText}\n                                        onChange={(e) => setFullText(e.target.value)}\n                                    >\n                                    </textarea>\n\n                                </div>\n                                <p className='message' ref={refMessage}>{message}</p>\n                                {id\n                                    ? <button className='save' onClick={() => changePost(id, token, title, description, fullText)}>Edit</button>\n                                    : <button className='btn-create' onClick={createPost}>Create post</button>\n                                }\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n            </div>\n        </div>\n\n    if (loading) {\n        return <Spinner />\n    }\n\n    if (error) {\n        return <Error />\n    }\n\n    return (\n        <>\n            {form}\n        </>\n    )\n}\n\nexport default WithServer()(CreateEditPost);"]},"metadata":{},"sourceType":"module"}