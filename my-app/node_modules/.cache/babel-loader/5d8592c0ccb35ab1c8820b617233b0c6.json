{"ast":null,"code":"var _jsxFileName = \"/home/ubuntu/\\u0420\\u0430\\u0431\\u043E\\u0447\\u0438\\u0439 \\u0441\\u0442\\u043E\\u043B/Daniil/FicusTest/my-app/src/components/CreateEdit-post/createEdit-post.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useRef, useState } from 'react';\nimport WithServer from '../hoc';\nimport { useHistory, useParams } from 'react-router';\nimport { useDispatch, useSelector } from 'react-redux';\nimport ModalConfirm from '../modalConfirm';\nimport Spinner from '../spinner';\nimport defaultImage from '../../image/default-image.jpg';\nimport defimg from '../../image/defimg.jpg';\nimport './createEdit-post.sass';\nimport { deletePost, createNewPost, updatePostImage, getPost, updatePost } from '../../redux/posts/actions';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst CreateEditPost = ({\n  Server\n}) => {\n  _s();\n\n  //useSelector\n  const loading = useSelector(state => state.postState.loading);\n  const token = useSelector(state => state.userState.isAuthorized);\n  const user = useSelector(state => state.userState.user);\n  const post = useSelector(state => state.postState.post); //refs\n\n  const refImagePost = useRef(); // Modal \n\n  const [show, setShow] = useState(false);\n\n  const closeDeleteModal = () => setShow(false);\n\n  const openDeleteModal = () => setShow(true); //useState\n\n\n  const [title, setTitle] = useState('');\n  const [description, setDescription] = useState('');\n  const [fullText, setFullText] = useState('');\n  const [postForm, setForm] = useState({\n    title: '',\n    description: '',\n    fullText: ''\n  });\n  const [image, setImage] = useState(null);\n  const [checkedImg, setChekedImg] = useState();\n  const [errorForm, setError] = useState({\n    error: false,\n    message: ''\n  });\n\n  const formError = text => {\n    setError({\n      error: true,\n      message: text\n    });\n\n    if (!postForm.title || !postForm.description || !postForm.fullText) {\n      //if (!title || !description || !fullText) {\n      setTimeout(() => setError({\n        error: false,\n        message: '',\n        success: false\n      }), 1600);\n    }\n  }; //useDispatch\n\n\n  const dispatch = useDispatch(); //History\n\n  const history = useHistory(); //useParams\n\n  const {\n    id\n  } = useParams(); //Effect and func\n  //?Edit...................................................................................................................\n  //checkImage or post\n\n  function checkImage(imageSrc, good, bad) {\n    const img = new Image();\n    img.src = imageSrc;\n    img.onload = good;\n    img.onerror = bad;\n  }\n\n  useEffect(() => {\n    if (id && post) {\n      checkImage(`https://nodejs-test-api-blog.herokuapp.com${post.image}`, () => {\n        setChekedImg(`https://nodejs-test-api-blog.herokuapp.com${post.image}`);\n      }, () => {\n        setChekedImg(defaultImage);\n      });\n    }\n  }, [id, post]); //\n\n  const changePost = (id, title, description, fullText) => {\n    //dispatch(updatePost(id, title, description, fullText, history, user, formError))\n    dispatch(updatePost(id, title, description, fullText, history, user, formError));\n  };\n\n  const changePostImage = (img, id) => {\n    let formData = new FormData();\n    formData.append('image', img);\n    dispatch(updatePostImage(id, formData, refImagePost));\n  };\n\n  const delPost = () => {\n    dispatch(deletePost(id, token, history));\n    closeDeleteModal();\n  }; //?Create...................................................................................................................\n\n\n  const createPost = () => {\n    dispatch(createNewPost(title, fullText, description, formError, history, user._id, image));\n  };\n\n  useEffect(() => {\n    if (id) {\n      dispatch(getPost(id));\n    }\n  }, [dispatch, id]);\n\n  if (loading && post) {\n    return /*#__PURE__*/_jsxDEV(Spinner, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 16\n    }, this);\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"editor\",\n      onClick: () => console.log(postForm),\n      children: [/*#__PURE__*/_jsxDEV(ModalConfirm, {\n        show: show,\n        handleClose: closeDeleteModal,\n        remove: delPost,\n        label: 'Are you sure you want to delete this post?'\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 117,\n        columnNumber: 17\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"editor-body\",\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"item\",\n          children: /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"item-post\",\n            children: /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"post-item-list\",\n              children: [post && id && /*#__PURE__*/_jsxDEV(\"button\", {\n                className: \"menu-post delete\",\n                onClick: () => openDeleteModal(),\n                children: /*#__PURE__*/_jsxDEV(\"i\", {\n                  className: \"fa fa-trash-o\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 131,\n                  columnNumber: 34\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 128,\n                columnNumber: 48\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"info-post\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"editor-header-post\",\n                  children: /*#__PURE__*/_jsxDEV(\"input\", {\n                    type: \"text\",\n                    title: \"Title your post\",\n                    className: `title editor-title ${errorForm.error && !title && 'border-error'}`,\n                    placeholder: post && id ? post.title : 'Title your post' //value={title}\n                    //onChange={(e) => setTitle(e.target.value)}\n                    ,\n                    value: postForm.title,\n                    onChange: e => setForm({ ...postForm,\n                      title: e.target.value\n                    })\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 134,\n                    columnNumber: 41\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 133,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"editor-description\",\n                  children: /*#__PURE__*/_jsxDEV(\"input\", {\n                    title: \"Description your post\",\n                    type: \"text\",\n                    className: `editor-description ${errorForm.error && !description && 'border-error'}`,\n                    placeholder: post && id ? post.description : 'Description your post' //value={description}\n                    //onChange={(e) => setDescription(e.target.value)}\n                    ,\n                    value: postForm.description,\n                    onChange: e => setForm({ ...postForm,\n                      description: e.target.value\n                    })\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 145,\n                    columnNumber: 41\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 144,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"editor-image\",\n                  children: [post && id ? /*#__PURE__*/_jsxDEV(\"img\", {\n                    src: checkedImg,\n                    alt: \"post_image\",\n                    className: \"post-image\",\n                    ref: refImagePost\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 158,\n                    columnNumber: 47\n                  }, this) : /*#__PURE__*/_jsxDEV(\"img\", {\n                    src: defimg,\n                    alt: \"post_img\",\n                    className: \"post-image\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 159,\n                    columnNumber: 47\n                  }, this), /*#__PURE__*/_jsxDEV(\"label\", {\n                    htmlFor: \"file-upload\",\n                    className: \"inp-upload\",\n                    children: [/*#__PURE__*/_jsxDEV(\"i\", {\n                      className: \"fa fa-camera\"\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 162,\n                      columnNumber: 45\n                    }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n                      type: \"file\",\n                      accept: \"image/*\",\n                      id: \"file-upload\",\n                      onChange: e => post && id ? changePostImage(e.target.files[0], id) : setImage(e.target.files[0])\n                    }, void 0, false, {\n                      fileName: _jsxFileName,\n                      lineNumber: 163,\n                      columnNumber: 45\n                    }, this)]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 161,\n                    columnNumber: 41\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 156,\n                  columnNumber: 37\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"editor-full-text\",\n                  children: /*#__PURE__*/_jsxDEV(\"textarea\", {\n                    title: \"Full text your post\",\n                    className: `form-control editor-full-text ${errorForm.error && !fullText && 'border-error'}`,\n                    rows: \"2\",\n                    placeholder: post && id ? post.fullText : 'Full text your post' //value={fullText}\n                    //onChange={(e) => setFullText(e.target.value)}\n                    ,\n                    value: postForm.fullText,\n                    onChange: e => setForm({ ...postForm,\n                      fullText: e.target.value\n                    })\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 172,\n                    columnNumber: 41\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 171,\n                  columnNumber: 37\n                }, this), id ? /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"save save-edit\",\n                  onClick: () => changePost(id, postForm.title, postForm.description, postForm.fullText),\n                  children: \"Edit\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 186,\n                  columnNumber: 43\n                }, this) : /*#__PURE__*/_jsxDEV(\"button\", {\n                  className: \"btn-create\",\n                  onClick: createPost,\n                  children: \"Create post\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 190,\n                  columnNumber: 43\n                }, this), errorForm.error && /*#__PURE__*/_jsxDEV(\"p\", {\n                  className: `form-error`,\n                  children: errorForm.message\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 195,\n                  columnNumber: 57\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 132,\n                columnNumber: 33\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 127,\n              columnNumber: 29\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 126,\n            columnNumber: 25\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 125,\n          columnNumber: 21\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 123,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 13\n    }, this)\n  }, void 0, false);\n};\n\n_s(CreateEditPost, \"vvmdKj+7KKYgfuAr/Dn10uuPOMM=\", false, function () {\n  return [useSelector, useSelector, useSelector, useSelector, useDispatch, useHistory, useParams];\n});\n\n_c = CreateEditPost;\nexport default WithServer()(CreateEditPost);\n\nvar _c;\n\n$RefreshReg$(_c, \"CreateEditPost\");","map":{"version":3,"sources":["/home/ubuntu/Рабочий стол/Daniil/FicusTest/my-app/src/components/CreateEdit-post/createEdit-post.js"],"names":["React","useEffect","useRef","useState","WithServer","useHistory","useParams","useDispatch","useSelector","ModalConfirm","Spinner","defaultImage","defimg","deletePost","createNewPost","updatePostImage","getPost","updatePost","CreateEditPost","Server","loading","state","postState","token","userState","isAuthorized","user","post","refImagePost","show","setShow","closeDeleteModal","openDeleteModal","title","setTitle","description","setDescription","fullText","setFullText","postForm","setForm","image","setImage","checkedImg","setChekedImg","errorForm","setError","error","message","formError","text","setTimeout","success","dispatch","history","id","checkImage","imageSrc","good","bad","img","Image","src","onload","onerror","changePost","changePostImage","formData","FormData","append","delPost","createPost","_id","console","log","e","target","value","files"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport WithServer from '../hoc';\nimport { useHistory, useParams } from 'react-router';\nimport { useDispatch, useSelector } from 'react-redux';\nimport ModalConfirm from '../modalConfirm';\nimport Spinner from '../spinner'\n\nimport defaultImage from '../../image/default-image.jpg'\nimport defimg from '../../image/defimg.jpg'\nimport './createEdit-post.sass'\n\nimport { deletePost, createNewPost, updatePostImage, getPost, updatePost } from '../../redux/posts/actions'\n\n\nconst CreateEditPost = ({ Server }) => {\n    //useSelector\n    const loading = useSelector(state => state.postState.loading)\n    const token = useSelector(state => state.userState.isAuthorized);\n    const user = useSelector(state => state.userState.user)\n    const post = useSelector(state => state.postState.post)\n\n    //refs\n    const refImagePost = useRef()\n\n    // Modal \n    const [show, setShow] = useState(false)\n    const closeDeleteModal = () => setShow(false)\n    const openDeleteModal = () => setShow(true)\n\n\n    //useState\n    const [title, setTitle] = useState('')\n    const [description, setDescription] = useState('')\n    const [fullText, setFullText] = useState('')\n    const [postForm, setForm] = useState({ title: '', description: '', fullText: '' })\n    const [image, setImage] = useState(null)\n    const [checkedImg, setChekedImg] = useState()\n    const [errorForm, setError] = useState({ error: false, message: '' })\n\n\n    const formError = (text) => {\n        setError({ error: true, message: text })\n        if (!postForm.title || !postForm.description || !postForm.fullText) {\n            //if (!title || !description || !fullText) {\n            setTimeout(() => setError({ error: false, message: '', success: false }), 1600)\n        }\n    }\n\n    //useDispatch\n    const dispatch = useDispatch()\n\n    //History\n    const history = useHistory()\n\n    //useParams\n    const { id } = useParams()\n\n\n    //Effect and func\n\n    //?Edit...................................................................................................................\n\n    //checkImage or post\n    function checkImage(imageSrc, good, bad) {\n        const img = new Image();\n        img.src = imageSrc;\n        img.onload = good;\n        img.onerror = bad;\n    }\n    useEffect(() => {\n        if (id && post) {\n            checkImage(\n                `https://nodejs-test-api-blog.herokuapp.com${post.image}`,\n                () => { setChekedImg(`https://nodejs-test-api-blog.herokuapp.com${post.image}`) },\n                () => { setChekedImg(defaultImage) }\n            )\n        }\n    }, [id, post])\n    //\n\n    const changePost = (id, title, description, fullText) => {\n        //dispatch(updatePost(id, title, description, fullText, history, user, formError))\n        dispatch(updatePost(id, title, description, fullText, history, user, formError))\n    }\n\n    const changePostImage = (img, id) => {\n        let formData = new FormData()\n        formData.append('image', img)\n        dispatch(updatePostImage(id, formData, refImagePost))\n    }\n\n    const delPost = () => {\n        dispatch(deletePost(id, token, history))\n        closeDeleteModal()\n    }\n\n    //?Create...................................................................................................................\n\n    const createPost = () => {\n        dispatch(createNewPost(title, fullText, description, formError, history, user._id, image))\n    }\n\n    useEffect(() => {\n        if (id) {\n            dispatch(getPost(id))\n        }\n    }, [dispatch, id])\n\n\n    if (loading && post) {\n        return <Spinner />\n    }\n\n    return (\n        <>\n            <div className='editor' onClick={() => console.log(postForm)}>\n                <ModalConfirm\n                    show={show}\n                    handleClose={closeDeleteModal}\n                    remove={delPost}\n                    label={'Are you sure you want to delete this post?'}\n                />\n                <div className='editor-body'>\n\n                    <div className=\"item\">\n                        <div className=\"item-post\">\n                            <div className=\"post-item-list\">\n                                {post && id && <button\n                                    className='menu-post delete'\n                                    onClick={() => openDeleteModal()}\n                                ><i className=\"fa fa-trash-o\"></i></button>}\n                                <div className=\"info-post\">\n                                    <div className='editor-header-post'>\n                                        <input type=\"text\"\n                                            title='Title your post'\n                                            className={`title editor-title ${errorForm.error && !title && 'border-error'}`}\n                                            placeholder={post && id ? post.title : 'Title your post'}\n                                            //value={title}\n                                            //onChange={(e) => setTitle(e.target.value)}\n                                            value={postForm.title}\n                                            onChange={(e) => setForm({ ...postForm, title: e.target.value })}\n                                        />\n                                    </div>\n                                    <div className='editor-description'>\n                                        <input\n                                            title='Description your post'\n                                            type=\"text\"\n                                            className={`editor-description ${errorForm.error && !description && 'border-error'}`}\n                                            placeholder={post && id ? post.description : 'Description your post'}\n                                            //value={description}\n                                            //onChange={(e) => setDescription(e.target.value)}\n                                            value={postForm.description}\n                                            onChange={(e) => setForm({ ...postForm, description: e.target.value })}\n                                        />\n                                    </div>\n                                    <div className='editor-image'>\n                                        {post && id\n                                            ? <img src={checkedImg} alt='post_image' className=\"post-image\" ref={refImagePost} />\n                                            : <img src={defimg} alt='post_img' className=\"post-image\" />\n                                        }\n                                        <label htmlFor='file-upload' className='inp-upload' >\n                                            <i className=\"fa fa-camera\"></i>\n                                            <input\n                                                type='file'\n                                                accept=\"image/*\"\n                                                id=\"file-upload\"\n                                                onChange={(e) => post && id ? changePostImage(e.target.files[0], id) : setImage(e.target.files[0])}\n                                            />\n                                        </label>\n                                    </div>\n                                    <div className='editor-full-text'>\n                                        <textarea\n                                            title='Full text your post'\n                                            className={`form-control editor-full-text ${errorForm.error && !fullText && 'border-error'}`}\n                                            rows=\"2\"\n                                            placeholder={post && id ? post.fullText : 'Full text your post'}\n                                            //value={fullText}\n                                            //onChange={(e) => setFullText(e.target.value)}\n                                            value={postForm.fullText}\n                                            onChange={(e) => setForm({ ...postForm, fullText: e.target.value })}\n                                        >\n                                        </textarea>\n\n                                    </div>\n                                    {id\n                                        ? <button\n                                            className='save save-edit'\n                                            onClick={() => changePost(id, postForm.title, postForm.description, postForm.fullText)}>\n                                            Edit</button>\n                                        : <button\n                                            className='btn-create'\n                                            onClick={createPost}>\n                                            Create post</button>\n                                    }\n                                    {errorForm.error && <p className={`form-error`}>{errorForm.message}</p>}\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                </div>\n            </div>\n        </>\n    )\n}\n\nexport default WithServer()(CreateEditPost);"]},"metadata":{},"sourceType":"module"}