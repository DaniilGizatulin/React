{"ast":null,"code":"import axios from 'axios';\nimport { fault, addUser, remove, logout, loaded } from '../actions';\nexport default class Server {\n  //!USER\n  //? Create user and authorization.................................................................................................\n  async loginUser(email, password, nav, dispatch) {\n    await axios.post(\"https://nodejs-test-api-blog.herokuapp.com/api/v1/auth\", {\n      email,\n      password\n    }).then(res => {\n      localStorage.setItem('token', res.data.token);\n\n      if (localStorage.getItem('token')) {\n        this.authorizationUser(localStorage.getItem('token')).then(res => {\n          dispatch(addUser(res.data));\n          let saveUser = JSON.stringify(res.data);\n          localStorage.setItem('user', saveUser);\n        });\n      }\n    }).catch(e => {\n      nav('/login');\n      dispatch(fault());\n    });\n  }\n\n  async authorizationUser(token) {\n    try {\n      const _res = await axios.get('https://nodejs-test-api-blog.herokuapp.com/api/v1/auth/user', {\n        headers: {\n          \"Authorization\": `Bearer ${token}`\n        }\n      });\n\n      return _res;\n    } catch (e) {\n      console.log(e.response);\n    }\n  }\n\n  async createNewUser(email, password, name, history, dispatch) {\n    try {\n      await axios.post(\"https://nodejs-test-api-blog.herokuapp.com/api/v1/users\", {\n        email,\n        password,\n        name\n      }).then(res => setTimeout(() => history.push('/login'), 500)).catch(e => dispatch(fault()));\n    } catch (e) {\n      console.log(e.response);\n    }\n  } //?Get user(s) ......................................................................................................................\n\n\n  async getAllUsers() {\n    try {\n      const res = await axios.get('https://nodejs-test-api-blog.herokuapp.com/api/v1/users');\n      return res;\n    } catch (e) {\n      console.log(e.response);\n    }\n  }\n\n  async getUser(id, refAvatar, defaultAvatar) {\n    try {\n      const res = await axios.get(`https://nodejs-test-api-blog.herokuapp.com/api/v1/users/${id}`).then(res => {\n        this.getImage(refAvatar, res.data.avatar, defaultAvatar);\n      });\n      return res;\n    } catch (e) {\n      return e.response;\n    }\n  }\n\n  async deleteUser(id, token, dispatch, history) {\n    await axios.delete(`https://nodejs-test-api-blog.herokuapp.com/api/v1/users/${id}`, {\n      headers: {\n        \"Authorization\": `Bearer ${token}`\n      }\n    }).then(res => {\n      dispatch(logout());\n      dispatch(remove(true));\n      localStorage.removeItem('user');\n      localStorage.removeItem('token');\n      setTimeout(() => {\n        history.push(\"/login\");\n        dispatch(remove(false));\n      }, 500);\n    });\n  } //?Update user and user avatar................................................................\n\n\n  async updateUserName(id, token, name, dispatch) {\n    await axios({\n      method: 'PATCH',\n      url: `https://nodejs-test-api-blog.herokuapp.com/api/v1/users/${id}`,\n      data: {\n        name\n      },\n      headers: {\n        \"Authorization\": `Bearer ${token}`\n      }\n    }).then(res => {\n      localStorage.setItem('user', JSON.stringify(res.data));\n      dispatch(addUser(res.data));\n    });\n  }\n\n  async updateUserAvatar(id, token, avatar, dispatch) {\n    await axios.put(`https://nodejs-test-api-blog.herokuapp.com/api/v1/users/upload/${id}`, avatar, {\n      headers: {\n        \"Authorization\": `Bearer ${token}`,\n        \"Content-Type\": ' multipart/form-data'\n      }\n    }).then(res => {\n      localStorage.setItem('user', JSON.stringify(res.data));\n      dispatch(addUser(res.data));\n    });\n  } //!POST\n  //?Get post(s) ...........................................................................................................................\n\n\n  async getAllPosts(skip = 0, limit = 10) {\n    try {\n      const res = await axios.get(`https://nodejs-test-api-blog.herokuapp.com/api/v1/posts?limit=${limit}&skip=${skip}`);\n      return res;\n    } catch (e) {\n      console.log(e.response);\n    }\n  }\n\n  async getPost(id, refImagePost, defaultImage, dispatch) {\n    try {\n      const res = await axios.get(`https://nodejs-test-api-blog.herokuapp.com/api/v1/posts/${id}`).then(res => {\n        dispatch(loaded());\n        this.getImage(refImagePost, res.data.image, defaultImage, '');\n      });\n      console.log(res);\n      return res;\n    } catch (e) {\n      console.log(e.response);\n    }\n  }\n\n  async deletePost(id, token, closeDeleteModal, dispatch, history) {\n    await axios.delete(`https://nodejs-test-api-blog.herokuapp.com/api/v1/posts/${id}`, {\n      headers: {\n        \"Authorization\": `Bearer ${token}`\n      }\n    }).then(res => {\n      closeDeleteModal();\n      dispatch(remove(true));\n      setTimeout(() => {\n        history.push(`/list/page${1}/?limit=10&skip=${0}`);\n        dispatch(remove(false));\n      }, 500);\n    });\n  } //?Create new post........................................................................\n\n\n  async createNewPost(title, fullText, description, token, dispatch) {\n    try {\n      const res = await axios.post(\"https://nodejs-test-api-blog.herokuapp.com/api/v1/posts\", {\n        title,\n        fullText,\n        description\n      }, {\n        headers: {\n          \"Authorization\": `Bearer ${token}`\n        }\n      });\n      return res;\n    } catch (e) {\n      dispatch(fault());\n      console.log(e.response);\n    }\n  } //?Update post and post image................................................................\n\n\n  async updatePost(id, token, title, description, fullText, history, user) {\n    await axios({\n      method: 'PATCH',\n      url: `https://nodejs-test-api-blog.herokuapp.com/api/v1/posts/${id}`,\n      data: {\n        title,\n        description,\n        fullText\n      },\n      headers: {\n        \"Authorization\": `Bearer ${token}`\n      }\n    }).then(res => setTimeout(() => history.push(`/user-posts/${user._id}`), 1500));\n  }\n\n  async updatePostImage(id, token, image, refImagePost) {\n    await axios.put(`https://nodejs-test-api-blog.herokuapp.com/api/v1/posts/upload/${id}`, image, {\n      headers: {\n        \"Authorization\": `Bearer ${token}`,\n        \"Content-Type\": ' multipart/form-data'\n      }\n    }).then(res => {\n      this.getPost(id).then(res => this.getImage(refImagePost, res.data.image));\n    });\n  } //*Like post........................................................\n\n\n  async setLikePost(id, token) {\n    try {\n      const res = await axios({\n        method: 'PUT',\n        url: `https://nodejs-test-api-blog.herokuapp.com/api/v1/posts/like/${id}`,\n        headers: {\n          \"Authorization\": `Bearer ${token}`\n        }\n      });\n      return res;\n    } catch (e) {\n      console.log(e.response);\n    }\n  } //? get Image post and avatar ...................................................................................\n\n\n  async getImage(ref, image, defaultImage, alt) {\n    await axios.get(`https://nodejs-test-api-blog.herokuapp.com${image}`).then(res => {\n      if (res.statusText === 'OK') {\n        ref.current.src = `https://nodejs-test-api-blog.herokuapp.com${image}`;\n      }\n    }).catch(e => {\n      if (e.status >= 400) {\n        ref.current.src = defaultImage;\n        ref.current.alt = alt;\n      }\n    });\n  }\n\n}","map":{"version":3,"sources":["/home/ubuntu/Рабочий стол/Daniil/FicusTest/my-app/src/services/server.js"],"names":["axios","fault","addUser","remove","logout","loaded","Server","loginUser","email","password","nav","dispatch","post","then","res","localStorage","setItem","data","token","getItem","authorizationUser","saveUser","JSON","stringify","catch","e","_res","get","headers","console","log","response","createNewUser","name","history","setTimeout","push","getAllUsers","getUser","id","refAvatar","defaultAvatar","getImage","avatar","deleteUser","delete","removeItem","updateUserName","method","url","updateUserAvatar","put","getAllPosts","skip","limit","getPost","refImagePost","defaultImage","image","deletePost","closeDeleteModal","createNewPost","title","fullText","description","updatePost","user","_id","updatePostImage","setLikePost","ref","alt","statusText","current","src","status"],"mappings":"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","sourcesContent":["import axios from 'axios';\nimport { fault, addUser, remove, logout, loaded } from '../actions';\n\nexport default class Server {\n\n    //!USER\n    //? Create user and authorization.................................................................................................\n\n    async loginUser(email, password, nav, dispatch) {\n        await axios.post(\"https://nodejs-test-api-blog.herokuapp.com/api/v1/auth\", {\n            email,\n            password,\n        })\n            .then(res => {\n                localStorage.setItem('token', res.data.token)\n                if (localStorage.getItem('token')) {\n                    this.authorizationUser(localStorage.getItem('token'))\n                        .then(res => {\n                            dispatch(addUser(res.data))\n                            let saveUser = JSON.stringify(res.data)\n                            localStorage.setItem('user', saveUser)\n                        })\n                }\n            })\n            .catch(e => {\n                nav('/login')\n                dispatch(fault())\n            })\n\n    }\n\n    async authorizationUser(token) {\n        try {\n            const _res = await axios.get('https://nodejs-test-api-blog.herokuapp.com/api/v1/auth/user', { headers: { \"Authorization\": `Bearer ${token}` } })\n            return _res\n        } catch (e) {\n            console.log(e.response);\n        }\n    }\n\n    async createNewUser(email, password, name, history, dispatch) {\n        try {\n            await axios.post(\"https://nodejs-test-api-blog.herokuapp.com/api/v1/users\", {\n                email,\n                password,\n                name\n            })\n                .then(res => setTimeout(() => history.push('/login'), 500))\n                .catch(e => dispatch(fault()))\n        } catch (e) {\n            console.log(e.response);\n        }\n    }\n\n    //?Get user(s) ......................................................................................................................\n\n    async getAllUsers() {\n        try {\n            const res = await axios.get('https://nodejs-test-api-blog.herokuapp.com/api/v1/users')\n            return res\n        } catch (e) {\n            console.log(e.response);\n        }\n    }\n\n    async getUser(id, refAvatar, defaultAvatar) {\n        try {\n            const res = await axios.get(`https://nodejs-test-api-blog.herokuapp.com/api/v1/users/${id}`)\n                .then(res => {\n                    this.getImage(refAvatar, res.data.avatar, defaultAvatar)\n                })\n            return res\n        } catch (e) {\n            return e.response\n        }\n    }\n\n\n    async deleteUser(id, token, dispatch, history) {\n        await axios.delete(`https://nodejs-test-api-blog.herokuapp.com/api/v1/users/${id}`, { headers: { \"Authorization\": `Bearer ${token}` } })\n            .then(res => {\n                dispatch(logout());\n                dispatch(remove(true))\n                localStorage.removeItem('user');\n                localStorage.removeItem('token');\n                setTimeout(() => {\n                    history.push(\"/login\")\n                    dispatch(remove(false))\n                }, 500)\n            })\n    }\n\n    //?Update user and user avatar................................................................\n\n    async updateUserName(id, token, name, dispatch) {\n        await axios({\n            method: 'PATCH',\n            url: `https://nodejs-test-api-blog.herokuapp.com/api/v1/users/${id}`,\n            data:\n            {\n                name,\n            },\n\n            headers:\n                { \"Authorization\": `Bearer ${token}` }\n\n        })\n            .then(res => {\n                localStorage.setItem('user', JSON.stringify(res.data))\n                dispatch(addUser(res.data))\n            })\n    }\n\n    async updateUserAvatar(id, token, avatar, dispatch) {\n        await axios.put(`https://nodejs-test-api-blog.herokuapp.com/api/v1/users/upload/${id}`, avatar, {\n            headers: {\n                \"Authorization\": `Bearer ${token}`,\n                \"Content-Type\": ' multipart/form-data'\n            }\n        }\n        )\n            .then(res => {\n                localStorage.setItem('user', JSON.stringify(res.data))\n                dispatch(addUser(res.data))\n            })\n    }\n\n    //!POST\n    //?Get post(s) ...........................................................................................................................\n\n    async getAllPosts(skip = 0, limit = 10) {\n        try {\n            const res = await axios.get(`https://nodejs-test-api-blog.herokuapp.com/api/v1/posts?limit=${limit}&skip=${skip}`)\n            return res\n        } catch (e) {\n            console.log(e.response)\n        }\n    }\n\n    async getPost(id, refImagePost, defaultImage, dispatch) {\n        try {\n            const res = await axios.get(`https://nodejs-test-api-blog.herokuapp.com/api/v1/posts/${id}`)\n                .then(res => {\n                    dispatch(loaded())\n                    this.getImage(refImagePost, res.data.image, defaultImage, '')\n                })\n            console.log(res)\n            return res\n        } catch (e) {\n            console.log(e.response)\n        }\n    }\n\n    async deletePost(id, token, closeDeleteModal, dispatch, history) {\n        await axios.delete(`https://nodejs-test-api-blog.herokuapp.com/api/v1/posts/${id}`, { headers: { \"Authorization\": `Bearer ${token}` } })\n            .then(res => {\n                closeDeleteModal()\n                dispatch(remove(true))\n                setTimeout(() => {\n                    history.push(`/list/page${1}/?limit=10&skip=${0}`)\n                    dispatch(remove(false))\n                }, 500)\n            })\n    }\n\n    //?Create new post........................................................................\n\n    async createNewPost(title, fullText, description, token, dispatch) {\n        try {\n            const res = await axios.post(\"https://nodejs-test-api-blog.herokuapp.com/api/v1/posts\",\n                {\n                    title,\n                    fullText,\n                    description,\n                },\n                {\n                    headers:\n                        { \"Authorization\": `Bearer ${token}` }\n                });\n            return res\n        } catch (e) {\n            dispatch(fault())\n            console.log(e.response)\n        }\n    }\n\n\n    //?Update post and post image................................................................\n\n    async updatePost(id, token, title, description, fullText, history, user) {\n        await axios({\n            method: 'PATCH',\n            url: `https://nodejs-test-api-blog.herokuapp.com/api/v1/posts/${id}`,\n            data:\n            {\n                title,\n                description,\n                fullText,\n            },\n\n            headers:\n                { \"Authorization\": `Bearer ${token}` }\n\n        })\n            .then(res => setTimeout(() => history.push(`/user-posts/${user._id}`), 1500))\n    }\n\n    async updatePostImage(id, token, image, refImagePost) {\n        await axios.put(`https://nodejs-test-api-blog.herokuapp.com/api/v1/posts/upload/${id}`, image, {\n            headers: {\n                \"Authorization\": `Bearer ${token}`,\n                \"Content-Type\": ' multipart/form-data'\n            }\n        }\n        )\n            .then(res => {\n                this.getPost(id)\n                    .then(res => this.getImage(refImagePost, res.data.image))\n            })\n\n\n    }\n\n    //*Like post........................................................\n\n    async setLikePost(id, token) {\n        try {\n            const res = await axios({\n                method: 'PUT',\n                url: `https://nodejs-test-api-blog.herokuapp.com/api/v1/posts/like/${id}`,\n                headers: {\n                    \"Authorization\": `Bearer ${token}`\n                }\n            })\n            return res\n        } catch (e) {\n            console.log(e.response)\n        }\n    }\n\n    //? get Image post and avatar ...................................................................................\n\n    async getImage(ref, image, defaultImage, alt) {\n        await axios.get(`https://nodejs-test-api-blog.herokuapp.com${image}`)\n            .then(res => {\n                if (res.statusText === 'OK') {\n                    ref.current.src = `https://nodejs-test-api-blog.herokuapp.com${image}`\n                }\n            })\n            .catch(e => {\n                if (e.status >= 400) {\n                    ref.current.src = defaultImage;\n                    ref.current.alt = alt;\n                }\n            })\n    }\n\n}\n\n\n\n"]},"metadata":{},"sourceType":"module"}